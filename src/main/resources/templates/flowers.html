<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Available Flowers</title>
    <style>
        .card-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content:center; }
        .card { border: 1px solid #ccc; padding: 10px; width: 250px; border-radius: 8px; box-shadow: 2px 2px 8px #aaa; text-align:center; }
        img { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; cursor:pointer; }
        h3, p { margin: 5px 0; }
        .price { font-weight: bold; color: green; }
        .popup { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
        .popup-content { background:white; padding:20px; border-radius:10px; text-align:center; }
        .btn { padding:8px 15px; border:none; border-radius:5px; cursor:pointer; margin:5px; }
        .btn-add { background:#4CAF50; color:white; }
        .btn-cancel { background:#f44336; color:white; }
    </style>
</head>
<body>

<h2 style="text-align:center;">Available Flowers</h2>

<div class="card-container">
    <div class="card" th:each="fw : ${flowers}">
        <div th:if="${fw.base64Image != null}">
            <img th:src="'data:image/jpeg;base64,' + ${fw.base64Image}" 
                 th:attr="data-id=${fw.flower.id}, data-name=${fw.flower.name}, data-price=${fw.flower.price}" 
                 onclick="openQuantityPopup(this)"/>
        </div>
        <h3 th:text="${fw.flower.name}"></h3>
        <p><strong>Color:</strong> <span th:text="${fw.flower.color}"></span></p>
        <p><strong>Description:</strong> <span th:text="${fw.flower.description}"></span></p>
        <p class="price">$<span th:text="${fw.flower.price}"></span></p>
        <p><strong>Stock:</strong> <span th:text="${fw.flower.stock}">units </span></p>
    </div>
</div>

<!-- Quantity Popup -->
<div class="popup" id="quantityPopup">
    <div class="popup-content">
        <p id="flowerName"></p>
        <label>Enter Units: </label>
        <input type="number" id="quantity" min="1" value="1"/>
        <br/><br/>
        <button class="btn btn-add" onclick="addToCart()">Add to Cart</button>
        <button class="btn btn-cancel" onclick="closeQuantityPopup()">Cancel</button>
    </div>
</div>

<script>
    let selectedFlower = {};

    function openQuantityPopup(img) {
        selectedFlower.id = img.getAttribute('data-id');
        selectedFlower.name = img.getAttribute('data-name');
        selectedFlower.price = img.getAttribute('data-price');
        document.getElementById('flowerName').innerText = `Add "${selectedFlower.name}" to Cart`;
        document.getElementById('quantityPopup').style.display = 'flex';
    }

    function closeQuantityPopup() {
        document.getElementById('quantityPopup').style.display = 'none';
    }

    function addToCart() {
        const qty = document.getElementById('quantity').value;
        window.location.href = `/orders/add?flowerId=${selectedFlower.id}&quantity=${qty}`;
    }
</script>

</body>
</html>
