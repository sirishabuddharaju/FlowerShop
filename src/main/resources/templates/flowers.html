<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Flowers</title>

    <style>
        body { font-family: Arial; margin: 0; padding: 0; }

        /* Header */
        .header {
            background: #28a745;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }
        .header a {
            color: white;
            text-decoration: none;
            margin: 0 15px;
            font-weight: bold;
        }

        .card-container { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 20px; 
            margin-top: 20px;
        }

        .card { 
            width: 250px; 
            background: white; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            padding: 15px; 
            text-align: center;
        }

        .card img { 
            width: 100%; 
            height: 200px; 
            object-fit: cover; 
            border-radius: 10px; 
        }

        .btn { 
            padding: 8px 15px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            margin-top: 10px; 
            background: #ff6fa5; 
            color: white;
        }

        /* Popup */
        .popup { 
            display: none; 
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); 
            justify-content: center; 
            align-items: center; 
        }

        .popup-content { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            text-align: center; 
        }
    </style>
</head>

<body>

<!-- HEADER -->
<div class="header">
    <h2>Flower Shop</h2>

    <div>
        <a th:href="@{/cart}">Cart</a>
        <a th:href="@{/orders}">My Orders</a>
    </div>
</div>


<!-- FLOWERS LIST -->
<div class="card-container">
    <div class="card" th:each="flowerObj : ${flowers}">

        <img th:if="${flowerObj.base64Image}"
             th:src="'data:image/jpeg;base64,' + ${flowerObj.base64Image}" alt="Flower Image"/>

        <h3 th:text="${flowerObj.flower.name}"></h3>
        <p>Color: <span th:text="${flowerObj.flower.color}"></span></p>
        <p>Price: â‚¹<span th:text="${flowerObj.flower.price}"></span></p>
        <p>Stock: <span th:text="${flowerObj.flower.stock}"></span> units</p>

        <!-- Updated Button -->
        <button class="btn" type="button"
                th:onclick="'openPopup(' + ${flowerObj.flower.id} + ');'">
            Add to Cart
        </button>

    </div>
</div>


<!-- POPUP -->
<div class="popup" id="quantityPopup">
    <div class="popup-content">
        <h3>Enter Quantity</h3>

        <input type="number" id="quantityInput" min="1" value="1" />

        <br><br>

        <!-- MUST BE POST -->
        <form id="addToCartForm" th:action="@{/cart/add}" method="post">
            <input type="hidden" name="flowerId" id="popupFlowerId">
            <input type="hidden" name="quantity" id="popupQuantity">
            <button class="btn" type="submit">Add</button>
        </form>

        <button class="btn" style="background:#777;" onclick="closePopup()">Cancel</button>
    </div>
</div>


<script>
    function openPopup(flowerId) {
        document.getElementById("popupFlowerId").value = flowerId;
        document.getElementById("quantityInput").value = 1;
        document.getElementById("quantityPopup").style.display = "flex";
    }

    function closePopup() {
        document.getElementById("quantityPopup").style.display = "none";
    }

    document.getElementById("addToCartForm").addEventListener("submit", function() {
        document.getElementById("popupQuantity").value =
            document.getElementById("quantityInput").value;
    });
</script>

</body>
</html>
